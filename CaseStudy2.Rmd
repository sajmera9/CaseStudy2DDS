---
title: "CaseStudy2"
author: "Satvik"
date: "3/26/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
employee.data = read.csv("Data/CaseStudy2-data.csv", header = TRUE)
employee.data
employee.data$JobSatisfaction = as.factor(employee.data$JobSatisfaction)
#check for missing values
library(naniar)
gg_miss_var(employee.data)
#no missing values in employee.data
sapply(employee.data, function(x) sum(is.na(x)))
```

```{r}
#
summary(employee.data)
no.attrition = employee.data %>% filter(Attrition == "No")
no.attrition$JobSatisfaction = as.factor(no.attrition$JobSatisfaction)

str(no.attrition)
yes.attrition = employee.data %>% filter(Attrition == "Yes")
yes.attrition$JobSatisfaction = as.factor(yes.attrition$JobSatisfaction)
str(yes.attrition)

```

```{r}
yes.attrition %>% ggplot(aes(x = Age)) + geom_histogram()
no.attrition %>% ggplot(aes(x = Age)) + geom_histogram()
```


```{r}
yes.attrition %>% ggplot(aes(x = Department)) + geom_bar()
no.attrition %>% ggplot(aes(x = Department)) + geom_bar()
```

```{r}
no.attrition %>% ggplot(aes(x = Department)) + geom_bar(fill=no.attrition$Department)
no.attrition %>% ggplot(mapping = aes(x = Department, y = ..prop.., group = 1)) + geom_bar(fill = Department)
yes.attrition %>% ggplot(mapping = aes(x = Department, y = ..prop.., group = 1)) + geom_bar()
```



```{r}
employee.data[employee.data$Attrition == "Yes",] %>% ggplot(aes(x=Department)) + geom_bar()
```

```{r}

```


```{r}
#convert job satisfaction to a factor and get bar plot, use percent 

employee.data %>% ggplot(aes(x = as.factor(employee.data$JobSatisfaction))) + geom_bar()


yes.attrition %>% ggplot(aes(x = as.factor(JobSatisfaction), fill = as.factor(JobSatisfaction), y=..prop.., group = 1)) + geom_bar() + ggtitle("Attrition")

yes.attrition %>% ggplot(aes(x = as.factor(JobSatisfaction), fill = factor(..x..), y=..prop.., group = 1)) + geom_bar() + ggtitle("Yes Attrition") + geom_text(aes( label = scales::percent(..prop..),y= ..prop.. ), stat= "count", vjust = -.5) + scale_y_continuous(labels = scales::percent) + labs(y = "Percent", fill="Satisfaction Level", x = "Job Satisfaction")

no.attrition %>% ggplot(aes(x = as.factor(JobSatisfaction), fill = factor(..x..), y=..prop.., group = 1)) + geom_bar() + ggtitle("No Attrition") + geom_text(aes( label = scales::percent(..prop..),y= ..prop.. ), stat= "count", vjust = -.5) + scale_y_continuous(labels = scales::percent) + labs(y = "Percent", fill="Satisfaction Level", x = "Job Satisfaction")

employee.data %>% group_by(JobSatisfaction) %>%
  summarise(
    count = n(),
    mean = mean(MonthlyRate, na.rm = TRUE),
    sd = sd(MonthlyRate, na.rm = TRUE),
    median = median(MonthlyRate, na.rm = TRUE),
    IQR = IQR(MonthlyRate, na.rm = TRUE)
  )



no.attrition %>% group_by(JobSatisfaction) %>%
  summarise(
    count = n(),
    mean = mean(MonthlyRate, na.rm = TRUE),
    sd = sd(MonthlyRate, na.rm = TRUE),
    median = median(MonthlyRate, na.rm = TRUE),
    IQR = IQR(MonthlyRate, na.rm = TRUE)
  )

#No
#all No attrition employees who were very satisfied out of all the employees
#1
141/(179+166+254+271)
#2
135/(179+166+254+271)
#3
211/(179+166+254+271)
#4
243/(179+166+254+271)

#Yes
yes.attrition %>% group_by(JobSatisfaction) %>%
  summarise(
    count = n(),
    mean = mean(MonthlyRate, na.rm = TRUE),
    sd = sd(MonthlyRate, na.rm = TRUE),
    median = median(MonthlyRate, na.rm = TRUE),
    IQR = IQR(MonthlyRate, na.rm = TRUE)
  )

(38)/(179+166+254+271)






no.attrition %>% ggplot(aes(x = as.factor(JobSatisfaction))) + geom_bar() + ggtitle("No Attrition")


fill = factor(..x..)


yes.attrition %>% ggplot(aes(x = as.factor(JobSatisfaction), fill = as.factor(JobSatisfaction))) + geom_bar() + ggtitle("Attrition")

no.attrition %>% ggplot(aes(x = as.factor(JobSatisfaction), fill = as.factor(JobSatisfaction))) + geom_bar() + ggtitle("No Attrition")


```

```{r}
ggplot(data = employee.data, aes(x=DailyRate)) +
geom_histogram(aes(fill=JobSatisfaction)) +
facet_wrap( ~ JobSatisfaction, ncol=2) +
theme_bw()


ggplot(data = employee.data, aes(x=HourlyRate)) +
geom_histogram(aes(fill=JobSatisfaction)) +
facet_wrap( ~ JobSatisfaction, ncol=2) +
theme_bw()

ggplot(data = employee.data, aes(x=MonthlyRate)) +
geom_histogram(aes(fill=JobSatisfaction)) +
facet_wrap( ~ JobSatisfaction, ncol=2) +
theme_bw()

ggplot(data = employee.data, aes(x=MonthlyIncome)) +
geom_histogram(aes(fill=JobSatisfaction)) +
facet_wrap( ~ JobSatisfaction, ncol=2) +
theme_bw()

ggplot(data = employee.data, aes(sample=MonthlyIncome)) +
stat_qq() +
facet_wrap( ~ JobSatisfaction, ncol=1) +
theme_bw()
```


```{r}
employee.data$JobSatisfaction = as.factor(employee.data$JobSatisfaction)

fit = aov(HourlyRate ~ JobSatisfaction, data = employee.data)
summary(fit)



ne = employee.data %>% select(JobSatisfaction,DailyRate)

ne %>% group_by(JobSatisfaction, DailyRate) %>% summarize(new_count = n())
employee.data %>% group_by(JobSatisfaction) %>% summarize(new_count = n())


employee.data %>%
  group_by(JobSatisfaction) %>%
  summarize(var=var(HourlyRate))


##***## 
##**## Job Satisfaction - HourlyRate
employee.data %>% group_by(JobSatisfaction) %>%
  summarise(
    count = n(),
    mean = mean(HourlyRate, na.rm = TRUE),
    sd = sd(HourlyRate, na.rm = TRUE),
    median = median(HourlyRate, na.rm = TRUE),
    IQR = IQR(HourlyRate, na.rm = TRUE)
  )
##***##

library(onewaytests)
fit = aov(HourlyRate~JobSatisfaction, data = employee.data)
summary(fit)

library(lsmeans)
#*******************SIGNIFICANT****************#
#Contrast 1
fit4 = lm(HourlyRate ~ JobSatisfaction, data = employee.data)
summary(fit4)
fit4

leastsquare = lsmeans(fit4,"JobSatisfaction")

Contrasts = list(OneTwoVersusThreeFour= c(0.5,0.5,-0.5,-0.5))

contrast(leastsquare,Contrasts)

#Contrast 2
fit4 = lm(HourlyRate ~ JobSatisfaction, data = employee.data)
summary(fit4)
fit4

leastsquare = lsmeans(fit4,"JobSatisfaction")

Contrasts = list(OneTwoVersusThreeFour= c(1,0,-0.5,-0.5))
#Contrasts = list(OneTwoVersusThreeFour= c(1,0,0,-1))
#Contrasts = list(OneTwoVersusThreeFour= c(1,0,0,-1))
contrast(leastsquare,Contrasts)




bf.test(HourlyRate ~ JobSatisfaction, data = employee.data)
welch.test(HourlyRate ~ JobSatisfaction, data = employee.data)


#Job Satisfaction - DailyRate
employee.data %>% group_by(JobSatisfaction) %>%
  summarise(
    count = n(),
    mean = mean(DailyRate, na.rm = TRUE),
    sd = sd(DailyRate, na.rm = TRUE),
    median = median(DailyRate, na.rm = TRUE),
    IQR = IQR(DailyRate, na.rm = TRUE)
  )


fit1 = aov(DailyRate~JobSatisfaction, data = employee.data)
summary(fit1)

#Job Satisfaction - MonthlyRate
employee.data %>% group_by(JobSatisfaction) %>%
  summarise(
    count = n(),
    mean = mean(MonthlyRate, na.rm = TRUE),
    sd = sd(MonthlyRate, na.rm = TRUE),
    median = median(MonthlyRate, na.rm = TRUE),
    IQR = IQR(MonthlyRate, na.rm = TRUE)
  )


fit2 = aov(MonthlyRate~JobSatisfaction, data = employee.data)
summary(fit2)

#Job Satisfaction - MonthlyIncome
employee.data %>% group_by(JobSatisfaction) %>%
  summarise(
    count = n(),
    mean = mean(MonthlyIncome, na.rm = TRUE),
    sd = sd(MonthlyIncome, na.rm = TRUE),
    median = median(MonthlyIncome, na.rm = TRUE),
    IQR = IQR(MonthlyIncome, na.rm = TRUE)
  )


bf.test(MonthlyIncome ~ JobSatisfaction, data = employee.data)
fit3 = aov(MonthlyIncome~JobSatisfaction, data = employee.data)
summary(fit3)
kruskal.test(MonthlyIncome ~ JobSatisfaction, data=employee.data)




bf.test(DailyRate ~ JobSatisfaction, data = employee.data)
welch.test(DailyRate ~ JobSatisfaction, data = employee.data)

bf.test(MonthlyIncome ~ JobSatisfaction, data = employee.data)
aov(MonthlyIncome ~ JobSatisfaction, data = employee.data)
welch.test(MonthlyIncome ~ JobSatisfaction, data = employee.data)

group_by(employee.data$JobSatisfaction) %>% summarize(meanAge = count(DailyRate))

```


```{r}
#NO ATTRITION

no.attrition %>% group_by(JobSatisfaction) %>%
  summarise(
    count = n(),
    mean = mean(MonthlyRate, na.rm = TRUE),
    sd = sd(MonthlyRate, na.rm = TRUE),
    median = median(MonthlyRate, na.rm = TRUE),
    IQR = IQR(MonthlyRate, na.rm = TRUE)
  )




fitno0 = aov(MonthlyRate~JobSatisfaction, data = no.attrition)
summary(fitno0)
fitno0
```

```{r}
#Yes Attrition
# yes.attrition ~ Jobsatisfaction
yes.attrition %>% group_by(JobSatisfaction) %>%
  summarise(
    count = n(),
    mean = mean(HourlyRate, na.rm = TRUE),
    sd = sd(HourlyRate, na.rm = TRUE),
    median = median(HourlyRate, na.rm = TRUE),
    IQR = IQR(HourlyRate, na.rm = TRUE)
  )
#not enough evidence
fityes = aov(HourlyRate~JobSatisfaction, data = yes.attrition)
summary(fityes)

# yes.attrition ~ Jobsatisfaction


#************Significant****************#

ggplot(data = yes.attrition, aes(x=MonthlyRate)) +
geom_histogram(aes(fill=JobSatisfaction)) +
facet_wrap( ~ JobSatisfaction, ncol=2) +
theme_bw()

yes.attrition %>% group_by(JobSatisfaction) %>%
  summarise(
    count = n(),
    mean = mean(MonthlyRate, na.rm = TRUE),
    sd = sd(MonthlyRate, na.rm = TRUE),
    median = median(MonthlyRate, na.rm = TRUE),
    IQR = IQR(MonthlyRate, na.rm = TRUE)
  )
hist(yes.attrition$MonthlyRate)



fityes0 = aov(MonthlyRate~JobSatisfaction, data = yes.attrition)
summary(fityes0)
fityes0

leastsquare = lsmeans(fityes0,"JobSatisfaction")

#Contrasts = list(AverageOneTwoVersusAverageThreeFour= c(0.5,0.5,-0.5,-0.5))
#contrast(leastsquare,Contrasts)

# Contrast2 = list(OneVersusAverageThreeFour= c(1,0,-0.5,-0.5))
# contrast(leastsquare,Contrast2)

# Contrast3 = list(OneVersusAverageTwoThreeFour= c(3,-1,-1,-1))
# contrast(leastsquare,Contrast3)

#Contrasts = list(OneTwoVersusThreeFour= c(1,0,0,-1))


#***************************#




#DailyRate
yes.attrition %>% group_by(JobSatisfaction) %>%
  summarise(
    count = n(),
    mean = mean(DailyRate, na.rm = TRUE),
    sd = sd(DailyRate, na.rm = TRUE),
    median = median(DailyRate, na.rm = TRUE),
    IQR = IQR(DailyRate, na.rm = TRUE)
  )



fityes1 = aov(DailyRate~JobSatisfaction, data = yes.attrition)
summary(fityes1)


#MonthlyIncome
yes.attrition %>% group_by(JobSatisfaction) %>%
  summarise(
    count = n(),
    mean = mean(MonthlyIncome, na.rm = TRUE),
    sd = sd(MonthlyIncome, na.rm = TRUE),
    median = median(MonthlyIncome, na.rm = TRUE),
    IQR = IQR(MonthlyIncome, na.rm = TRUE)
  )



fityes2 = aov(MonthlyIncome~JobSatisfaction, data = yes.attrition)
summary(fityes2)


fityes3 = aov(MonthlyIncome~JobSatisfaction, data = yes.attrition)
summary(fityes2)

#MonthlyRate
```

```{r}
yes.attrition %>% ggplot(aes(x = as.factor(yes.attrition$YearsSinceLastPromotion))) + geom_bar()
no.attrition %>% ggplot(aes(x = as.factor(no.attrition$YearsSinceLastPromotion))) + geom_bar()

yes.attrition %>% ggplot(aes(x = as.factor(YearsSinceLastPromotion), fill = factor(..x..), y=..prop.., group = 1)) + geom_bar() + ggtitle("Yes Attrition") + geom_text(aes( label = scales::percent(..prop..),y= ..prop.. ), stat= "count", vjust = -.5) + scale_y_continuous(labels = scales::percent) + labs(y = "Percent", fill="Years", x = "YearsSinceLastPromotion")


employee.data %>% group_by(YearsSinceLastPromotion) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )

yes.attrition %>% group_by(YearsSinceLastPromotion) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )

no.attrition %>% group_by(YearsSinceLastPromotion) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )

yes.attrition %>% group_by(JobInvolvement) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )

no.attrition %>% group_by(JobInvolvement) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )


no.attrition %>% group_by(EducationField) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )

#Life sciences and medical field composed of over half the people that left. (53+37)/140

no.attrition %>% group_by(EducationField) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )


yes.attrition %>% group_by(EducationField) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )

#high turnover in the research&development and sales department

yes.attrition %>% group_by(Department) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )

no.attrition %>% group_by(Department) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )


no.attrition %>% group_by(EnvironmentSatisfaction) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )

yes.attrition %>% group_by(EnvironmentSatisfaction) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )

#*****#

no.attrition %>% group_by(JobRole) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )

yes.attrition %>% group_by(JobRole) %>%
  summarise(
    count = n(),
    # mean = mean(MonthlyRate, na.rm = TRUE),
    # sd = sd(MonthlyRate, na.rm = TRUE),
    # median = median(MonthlyRate, na.rm = TRUE),
    # IQR = IQR(MonthlyRate, na.rm = TRUE)
  )




no.attrition %>% ggplot(aes(x = as.factor(YearsSinceLastPromotion), fill = factor(..x..), y=..prop.., group = 1)) + geom_bar() + ggtitle("No Attrition") + geom_text(aes( label = scales::percent(..prop..),y= ..prop.. ), stat= "count", vjust = -.5) + scale_y_continuous(labels = scales::percent) + labs(y = "Percent", fill="Years", x = "YearsSinceLastPromotion")

```


